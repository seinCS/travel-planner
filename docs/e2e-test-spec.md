# E2E Test Specification

> Travel Planner 애플리케이션의 E2E 테스트 명세 문서

## 테스트 대상 페이지 개요

| 페이지 | 경로 | 인증 필요 | 설명 |
|--------|------|----------|------|
| 랜딩 페이지 | `/` | X | 서비스 소개 및 로그인 유도 |
| 로그인 페이지 | `/login` | X | Google OAuth 로그인 |
| 프로젝트 목록 | `/projects` | O | 사용자의 여행 프로젝트 목록 |
| 프로젝트 상세 | `/projects/[id]` | O | 프로젝트 상세 (지도, 장소, 입력) |
| 공유 페이지 | `/s/[token]` | X | 읽기 전용 공유 페이지 |

---

## 1. 랜딩 페이지 (`/`)

### 페이지 구성
- 헤더: 로고("여행 플래너"), 로그인 버튼
- 메인 영역:
  - 헤드라인: "SNS 스크린샷으로 여행 계획을 한번에"
  - 설명 텍스트
  - "무료로 시작하기" CTA 버튼
  - 3개의 기능 소개 카드 (스크린샷 업로드, AI 자동 추출, 지도 시각화)

### 테스트 시나리오

#### TC-1.1: 페이지 로드 확인
```
Given: 사용자가 브라우저를 열었을 때
When: "/" 경로에 접속하면
Then:
  - 페이지 제목이 "여행 플래너"를 포함해야 함
  - "SNS 스크린샷으로" 텍스트가 보여야 함
  - "무료로 시작하기" 버튼이 보여야 함
  - 3개의 기능 소개 카드가 보여야 함
```

#### TC-1.2: 헤더 로그인 버튼 클릭
```
Given: 사용자가 랜딩 페이지에 있을 때
When: 헤더의 "로그인" 버튼을 클릭하면
Then: "/login" 페이지로 이동해야 함
```

#### TC-1.3: CTA 버튼 클릭
```
Given: 사용자가 랜딩 페이지에 있을 때
When: "무료로 시작하기" 버튼을 클릭하면
Then: "/login" 페이지로 이동해야 함
```

---

## 2. 로그인 페이지 (`/login`)

### 페이지 구성
- 중앙 정렬된 로그인 카드
  - 제목: "여행 플래너"
  - 설명: "SNS 스크린샷을 업로드하면..."
  - "Google로 계속하기" 버튼
  - 약관 동의 안내 텍스트

### 테스트 시나리오

#### TC-2.1: 로그인 페이지 로드
```
Given: 사용자가 브라우저를 열었을 때
When: "/login" 경로에 접속하면
Then:
  - "여행 플래너" 제목이 보여야 함
  - "Google로 계속하기" 버튼이 보여야 함
  - 이용약관 안내 텍스트가 보여야 함
```

#### TC-2.2: Google 로그인 버튼 클릭
```
Given: 사용자가 로그인 페이지에 있을 때
When: "Google로 계속하기" 버튼을 클릭하면
Then: Google OAuth 인증 페이지로 리다이렉트되어야 함
```

#### TC-2.3: 로그인 성공 후 리다이렉트
```
Given: 사용자가 Google 인증을 완료했을 때
When: 인증 성공 콜백이 처리되면
Then: "/projects" 페이지로 리다이렉트되어야 함
```

---

## 3. 프로젝트 목록 페이지 (`/projects`)

### 페이지 구성
- 헤더 영역:
  - 제목: "내 여행 프로젝트"
  - 설명: "SNS 스크린샷을 업로드하여..."
  - "+ 새 프로젝트" 버튼
- 프로젝트 목록:
  - 프로젝트 카드 그리드 (2-3열)
  - 각 카드: 이름, 여행지, 장소 수, 이미지 수, 수정일, 삭제 버튼
- 빈 상태: "아직 프로젝트가 없습니다" 메시지

### 테스트 시나리오

#### TC-3.1: 인증되지 않은 사용자 접근
```
Given: 로그인하지 않은 사용자가
When: "/projects" 경로에 접속하면
Then: "/login" 페이지로 리다이렉트되어야 함
```

#### TC-3.2: 빈 프로젝트 목록 표시
```
Given: 로그인한 사용자가 프로젝트가 없을 때
When: "/projects" 페이지에 접속하면
Then:
  - "아직 프로젝트가 없습니다" 메시지가 보여야 함
  - "첫 번째 여행 프로젝트를 만들어보세요!" 텍스트가 보여야 함
```

#### TC-3.3: 프로젝트 목록 표시
```
Given: 로그인한 사용자가 1개 이상의 프로젝트를 가지고 있을 때
When: "/projects" 페이지에 접속하면
Then:
  - 프로젝트 카드들이 그리드로 표시되어야 함
  - 각 카드에 프로젝트 이름, 여행지, 장소 수가 표시되어야 함
```

#### TC-3.4: 새 프로젝트 생성 다이얼로그 열기
```
Given: 사용자가 프로젝트 목록 페이지에 있을 때
When: "+ 새 프로젝트" 버튼을 클릭하면
Then: 새 프로젝트 생성 다이얼로그가 열려야 함
```

#### TC-3.5: 새 프로젝트 생성 - 필수 필드 검증
```
Given: 새 프로젝트 다이얼로그가 열려 있을 때
When: 프로젝트 이름과 여행지를 비워두고 생성 버튼을 누르면
Then: 생성 버튼이 비활성화 상태여야 함
```

#### TC-3.6: 새 프로젝트 생성 성공
```
Given: 새 프로젝트 다이얼로그에서
When:
  - 프로젝트 이름: "도쿄 여행 2026"
  - 여행지: "도쿄"
  - 국가: "일본" (선택사항)
  를 입력하고 "생성" 버튼을 클릭하면
Then:
  - "프로젝트가 생성되었습니다" 토스트가 표시되어야 함
  - 다이얼로그가 닫혀야 함
  - 목록에 새 프로젝트 카드가 추가되어야 함
```

#### TC-3.7: 프로젝트 삭제
```
Given: 프로젝트 카드가 표시되어 있을 때
When: 삭제 버튼을 클릭하고 확인하면
Then:
  - "프로젝트가 삭제되었습니다" 토스트가 표시되어야 함
  - 해당 프로젝트 카드가 목록에서 사라져야 함
```

#### TC-3.8: 프로젝트 카드 클릭
```
Given: 프로젝트 카드가 표시되어 있을 때
When: 프로젝트 카드를 클릭하면
Then: "/projects/[id]" 상세 페이지로 이동해야 함
```

---

## 4. 프로젝트 상세 페이지 (`/projects/[id]`)

### 페이지 구성
- 헤더:
  - 프로젝트 이름
  - 여행지/국가 정보
  - "이미지 분석" 버튼 (pending/failed 이미지 있을 때)
  - "텍스트 분석" 버튼 (pending/failed 텍스트 있을 때)
  - "공유" 버튼
- 3컬럼 레이아웃:
  - 왼쪽: Google Maps 지도
  - 가운데: 장소 목록 (카테고리 필터, 장소 카드)
  - 오른쪽: 입력 탭 (이미지/텍스트/URL)
- 모달들:
  - 이미지 상세 모달
  - 장소 상세 패널
  - 장소 편집 모달
  - 공유 모달

### 4.1 입력 기능 테스트

#### TC-4.1.1: 이미지 탭 표시
```
Given: 프로젝트 상세 페이지에 있을 때
When: 입력 탭에서 "이미지" 탭이 선택되면
Then:
  - 드래그앤드롭 영역이 표시되어야 함
  - "파일 선택" 버튼이 표시되어야 함
  - "JPG, PNG, WEBP (최대 20장)" 안내가 표시되어야 함
```

#### TC-4.1.2: 이미지 드래그앤드롭 업로드
```
Given: 이미지 탭이 선택되어 있을 때
When: JPG 이미지를 드래그앤드롭 영역에 놓으면
Then:
  - 업로드 진행률이 표시되어야 함
  - "이미지 압축 중..." 상태가 표시되어야 함
  - "서버에 업로드 중..." 상태로 변경되어야 함
  - 업로드 완료 후 토스트가 표시되어야 함
  - 이미지 목록에 업로드된 이미지가 추가되어야 함
```

#### TC-4.1.3: 텍스트 탭 입력
```
Given: 프로젝트 상세 페이지에서 "텍스트" 탭을 선택했을 때
When: 10자 이상의 텍스트를 입력하고 "저장" 버튼을 클릭하면
Then:
  - "저장되었습니다" 토스트가 표시되어야 함
  - 텍스트 입력 목록에 새 항목이 추가되어야 함
  - 텍스트 영역이 초기화되어야 함
```

#### TC-4.1.4: 텍스트 입력 최소 길이 검증
```
Given: "텍스트" 탭이 선택되어 있을 때
When: 10자 미만의 텍스트를 입력하면
Then: "저장" 버튼이 비활성화 상태여야 함
```

#### TC-4.1.5: URL 탭 입력
```
Given: "URL" 탭이 선택되어 있을 때
When: 유효한 URL을 입력하고 "저장" 버튼을 클릭하면
Then:
  - "저장되었습니다" 토스트가 표시되어야 함
  - 텍스트 입력 목록에 URL 타입의 새 항목이 추가되어야 함
```

#### TC-4.1.6: 잘못된 URL 형식 검증
```
Given: "URL" 탭이 선택되어 있을 때
When: 잘못된 형식의 URL(예: "not-a-url")을 입력하면
Then: "저장" 버튼이 비활성화 상태여야 함
```

### 4.2 AI 분석 기능 테스트

#### TC-4.2.1: 이미지 분석 버튼 표시
```
Given: pending 또는 failed 상태의 이미지가 있을 때
When: 프로젝트 상세 페이지를 보면
Then: "이미지 분석 (N)" 버튼이 표시되어야 함 (N = pending + failed 수)
```

#### TC-4.2.2: 이미지 분석 실행
```
Given: pending 상태의 이미지가 있을 때
When: "이미지 분석" 버튼을 클릭하면
Then:
  - 버튼이 "처리 중..." 상태로 변경되어야 함
  - 분석 완료 후 "처리 완료: N개 성공, M개 실패" 토스트가 표시되어야 함
  - 추출된 장소가 장소 목록에 추가되어야 함
  - 지도에 새 마커가 표시되어야 함
```

#### TC-4.2.3: 텍스트 분석 실행
```
Given: pending 상태의 텍스트 입력이 있을 때
When: "텍스트 분석" 버튼을 클릭하면
Then:
  - 버튼이 "처리 중..." 상태로 변경되어야 함
  - 분석 완료 후 "텍스트 처리 완료" 토스트가 표시되어야 함
  - 추출된 장소가 장소 목록에 추가되어야 함
```

### 4.3 장소 목록 기능 테스트

#### TC-4.3.1: 카테고리 필터링
```
Given: 여러 카테고리의 장소가 있을 때
When: "맛집" 카테고리 버튼을 클릭하면
Then:
  - restaurant 카테고리의 장소만 목록에 표시되어야 함
  - 해당 카테고리 버튼이 활성화 상태로 변경되어야 함
  - 지도에서도 해당 카테고리의 마커만 표시되어야 함 (선택적)
```

#### TC-4.3.2: 전체 필터로 초기화
```
Given: 카테고리 필터가 적용되어 있을 때
When: "전체" 버튼을 클릭하면
Then: 모든 장소가 목록에 다시 표시되어야 함
```

#### TC-4.3.3: 장소 선택
```
Given: 장소 목록에 장소들이 있을 때
When: 특정 장소 카드를 클릭하면
Then:
  - 해당 장소 카드가 선택 상태(파란색 테두리)로 변경되어야 함
  - 지도가 해당 장소 위치로 포커스되어야 함
  - 해당 마커가 강조되어야 함
```

#### TC-4.3.4: 장소 상세 패널 열기
```
Given: 장소 카드가 표시되어 있을 때
When: "상세" 버튼을 클릭하면
Then:
  - 오른쪽에 장소 상세 패널이 열려야 함
  - Google Place 정보(주소, 평점, 가격대 등)가 표시되어야 함
```

#### TC-4.3.5: 장소 수정 모달 열기
```
Given: 장소 카드가 표시되어 있을 때
When: "수정" 버튼을 클릭하면
Then:
  - 장소 편집 모달이 열려야 함
  - 기존 정보(이름, 카테고리, 코멘트)가 입력되어 있어야 함
```

#### TC-4.3.6: 장소 수정 저장
```
Given: 장소 편집 모달이 열려 있을 때
When: 장소 이름을 변경하고 "저장" 버튼을 클릭하면
Then:
  - "장소가 수정되었습니다" 토스트가 표시되어야 함
  - 목록에서 해당 장소의 이름이 업데이트되어야 함
  - 모달이 닫혀야 함
```

#### TC-4.3.7: 장소 삭제
```
Given: 장소 카드가 표시되어 있을 때
When: "삭제" 버튼을 클릭하고 확인 다이얼로그에서 확인하면
Then:
  - "장소가 삭제되었습니다" 토스트가 표시되어야 함
  - 해당 장소가 목록에서 사라져야 함
  - 지도에서 해당 마커가 사라져야 함
```

### 4.4 지도 기능 테스트

#### TC-4.4.1: 지도 초기 로드
```
Given: 프로젝트 상세 페이지에 접속할 때
When: 페이지가 로드되면
Then:
  - Google Maps가 표시되어야 함
  - 프로젝트 여행지 위치가 지도 중심에 표시되어야 함
```

#### TC-4.4.2: 마커 표시
```
Given: 장소가 추가되어 있을 때
When: 지도를 보면
Then:
  - 각 장소에 카테고리별 색상의 마커가 표시되어야 함
```

#### TC-4.4.3: 마커 클릭
```
Given: 지도에 마커가 표시되어 있을 때
When: 마커를 클릭하면
Then:
  - 해당 장소가 장소 목록에서 선택되어야 함
  - 정보 창(InfoWindow)이 표시되어야 함
```

### 4.5 공유 기능 테스트

#### TC-4.5.1: 공유 모달 열기
```
Given: 프로젝트 상세 페이지에 있을 때
When: "공유" 버튼을 클릭하면
Then:
  - 공유 모달이 열려야 함
  - 공유 토글 스위치가 표시되어야 함
```

#### TC-4.5.2: 공유 활성화
```
Given: 공유 모달이 열려 있고 공유가 비활성화 상태일 때
When: 공유 토글을 켜면
Then:
  - "공유가 활성화되었습니다" 토스트가 표시되어야 함
  - 공유 URL이 표시되어야 함
  - 복사 버튼이 표시되어야 함
  - 경고 메시지가 표시되어야 함
```

#### TC-4.5.3: 공유 링크 복사
```
Given: 공유가 활성화되어 있을 때
When: 복사 버튼을 클릭하면
Then:
  - "링크가 복사되었습니다" 토스트가 표시되어야 함
  - 클립보드에 공유 URL이 복사되어야 함
```

#### TC-4.5.4: 공유 비활성화
```
Given: 공유가 활성화되어 있을 때
When: 공유 토글을 끄면
Then:
  - "공유가 비활성화되었습니다" 토스트가 표시되어야 함
  - 공유 URL이 사라져야 함
```

---

## 5. 공유 페이지 (`/s/[token]`)

### 페이지 구성
- 헤더:
  - 프로젝트 이름
  - 여행지/국가 정보
  - "공유된 여행 계획" 배지
  - "내 프로젝트로 복사" 버튼
- 2컬럼 레이아웃:
  - 왼쪽: Google Maps 지도
  - 오른쪽: 장소 목록 (읽기 전용)
- 장소 상세 패널 (읽기 전용)
- 푸터

### 테스트 시나리오

#### TC-5.1: 유효한 공유 링크 접속
```
Given: 공유가 활성화된 프로젝트의 토큰이 있을 때
When: "/s/[token]" 경로에 접속하면
Then:
  - 프로젝트 이름이 표시되어야 함
  - 여행지 정보가 표시되어야 함
  - 지도에 장소 마커들이 표시되어야 함
  - 장소 목록이 표시되어야 함
```

#### TC-5.2: 유효하지 않은 토큰 접속
```
Given: 존재하지 않는 토큰으로
When: "/s/invalid-token" 경로에 접속하면
Then:
  - "페이지를 찾을 수 없습니다" 에러 메시지가 표시되어야 함
```

#### TC-5.3: 비활성화된 공유 접속
```
Given: 공유가 비활성화된 프로젝트의 토큰으로
When: 해당 공유 링크에 접속하면
Then:
  - "공유가 비활성화되었습니다" 에러 메시지가 표시되어야 함
```

#### TC-5.4: 카테고리 필터링 (읽기 전용)
```
Given: 공유 페이지에서 여러 카테고리의 장소가 있을 때
When: 특정 카테고리 버튼을 클릭하면
Then: 해당 카테고리의 장소만 필터링되어 표시되어야 함
```

#### TC-5.5: 장소 상세 보기
```
Given: 공유 페이지의 장소 목록에서
When: "상세" 버튼을 클릭하면
Then:
  - 장소 상세 패널이 열려야 함
  - 수정/삭제 버튼이 없어야 함 (읽기 전용)
```

#### TC-5.6: 비로그인 사용자의 복사 시도
```
Given: 로그인하지 않은 사용자가 공유 페이지에 있을 때
When: "내 프로젝트로 복사" 버튼을 클릭하면
Then:
  - "로그인이 필요합니다" 토스트가 표시되어야 함
  - "/login" 페이지로 리다이렉트되어야 함
```

#### TC-5.7: 로그인 사용자의 프로젝트 복사
```
Given: 로그인한 사용자가 공유 페이지에 있을 때
When: "내 프로젝트로 복사" 버튼을 클릭하면
Then:
  - "복사 중..." 상태가 표시되어야 함
  - "프로젝트가 복사되었습니다 (N개 장소)" 토스트가 표시되어야 함
  - 복사된 프로젝트의 상세 페이지로 리다이렉트되어야 함
```

---

## 6. 크로스 페이지 테스트

### TC-6.1: 인증 세션 유지
```
Given: 로그인한 사용자가
When: 여러 페이지를 이동해도
Then: 로그인 상태가 유지되어야 함
```

### TC-6.2: 프로젝트 생성 후 상세 페이지 접근
```
Given: 프로젝트 목록에서 새 프로젝트를 생성한 후
When: 해당 프로젝트 카드를 클릭하면
Then: 빈 상태의 프로젝트 상세 페이지가 올바르게 표시되어야 함
```

### TC-6.3: 장소 추가 후 공유 페이지 확인
```
Given: 프로젝트에 장소를 추가하고 공유를 활성화한 후
When: 공유 링크로 접속하면
Then: 추가한 장소가 공유 페이지에도 표시되어야 함
```

---

## 7. 에러 핸들링 테스트

### TC-7.1: 네트워크 오류 처리
```
Given: 네트워크가 불안정할 때
When: API 요청이 실패하면
Then: 적절한 에러 토스트가 표시되어야 함
```

### TC-7.2: 존재하지 않는 프로젝트 접근
```
Given: 존재하지 않는 프로젝트 ID로
When: "/projects/[invalid-id]"에 접속하면
Then: "/projects" 목록 페이지로 리다이렉트되어야 함
```

### TC-7.3: 이미지 업로드 실패 처리
```
Given: 지원하지 않는 파일 형식을 업로드할 때
When: 드래그앤드롭으로 업로드하면
Then: "업로드 실패" 메시지가 표시되어야 함
```

---

## 테스트 데이터 요구사항

### 테스트 사용자
- 테스트용 Google 계정 필요
- 또는 Playwright/Cypress의 mock authentication 사용

### 테스트 프로젝트
- 빈 프로젝트
- 장소가 있는 프로젝트 (각 카테고리별 최소 1개)
- 공유가 활성화된 프로젝트
- 공유가 비활성화된 프로젝트

### 테스트 이미지
- 유효한 JPG/PNG 이미지
- 10MB 초과 이미지 (에러 테스트용)
- 지원하지 않는 형식 이미지 (에러 테스트용)

---

## 테스트 환경 설정

### 필수 환경 변수
```env
DATABASE_URL=... (테스트 DB)
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=... (테스트용 API 키)
ANTHROPIC_API_KEY=... (테스트용 또는 mock)
```

### 권장 테스트 프레임워크
- **Playwright**: Next.js 공식 권장, 크로스 브라우저 지원
- **Cypress**: 직관적인 UI, 좋은 디버깅 경험

### 테스트 실행 전 준비사항
1. 테스트 DB 마이그레이션
2. 테스트 사용자 시드 데이터
3. 환경 변수 설정
4. 개발 서버 또는 빌드된 앱 실행

---

## 우선순위

### P0 (필수)
- TC-3.6: 새 프로젝트 생성
- TC-4.1.2: 이미지 업로드
- TC-4.2.2: 이미지 분석
- TC-4.3.3: 장소 선택
- TC-5.1: 공유 페이지 접속

### P1 (중요)
- TC-2.3: 로그인 플로우
- TC-3.7: 프로젝트 삭제
- TC-4.3.7: 장소 삭제
- TC-4.5.2: 공유 활성화
- TC-5.7: 프로젝트 복사

### P2 (보통)
- 카테고리 필터링
- 장소 수정
- 텍스트/URL 입력
- 에러 핸들링
