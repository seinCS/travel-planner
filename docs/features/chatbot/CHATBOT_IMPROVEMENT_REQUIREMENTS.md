# Chatbot Improvement Requirements

> **문서 버전**: v1.0
> **작성일**: 2026-01-27
> **상태**: 요구사항 정의 (브레인스토밍 완료)
> **다음 단계**: `/sc:design` → 아키텍처 설계, `/sc:workflow` → 구현 계획

---

## 1. 개요

### 1.1 목적
현재 구현 완료된 챗봇(v2.0)의 응답 품질, 기능, UX/UI, 성능을 종합적으로 개선하여 사용자 가치를 극대화한다.

### 1.2 현재 상태
- Google Gemini 2.0 Flash 기반 SSE 스트리밍 챗봇
- 장소 추천 + 여행 Q&A + 세션 관리
- 22개 보안 패턴, 3단계 사용량 제한, Circuit Breaker
- 23개 E2E 테스트

### 1.3 우선순위 정의
| 등급 | 의미 |
|------|------|
| P0 | 반드시 구현 (핵심 가치) |
| P1 | 높은 우선순위 (사용자 경험 개선) |
| P2 | 중간 우선순위 (차별화 기능) |
| P3 | 낮은 우선순위 (향후 고려) |

---

## 2. 응답 품질 개선

### 2.1 맥락 이해력 강화 [P0]

**현재 문제**: 마지막 10턴만 컨텍스트로 전달하여 긴 대화에서 맥락 유실

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-2.1.1 | 프로젝트 컨텍스트 주입 | 프로젝트의 전체 장소 목록, 일정 정보, 여행 날짜를 시스템 프롬프트에 포함 |
| RQ-2.1.2 | 사용자 선호도 분석 | 추가한 장소의 카테고리 비율, 최근 검색 패턴을 요약하여 프롬프트에 반영 |
| RQ-2.1.3 | 대화 요약 기능 | 10턴 초과 시 이전 대화를 LLM으로 요약하여 컨텍스트로 유지 (토큰 절감 + 맥락 보존) |
| RQ-2.1.4 | 대화 주제 추적 | 현재 대화의 주제(지역, 카테고리, 조건)를 추출하여 후속 질문에 자동 반영 |

### 2.2 추천 정확도 향상 [P0]

**현재 문제**: Gemini가 존재하지 않는 장소를 추천하거나, 폐업한 곳을 안내할 수 있음

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-2.2.1 | 실존 장소 검증 | 추천 장소를 Google Places API로 검증하고 미검증 장소에 경고 표시 |
| RQ-2.2.2 | 실시간 장소 정보 | 리뷰 점수(별점), 영업시간, 가격대를 Places API에서 가져와 카드에 표시 |
| RQ-2.2.3 | 동선 고려 추천 | 이미 추가된 장소와의 거리를 계산하여 가까운 장소 우선 추천 |
| RQ-2.2.4 | 중복 추천 방지 | 이미 프로젝트에 추가된 장소는 추천에서 제외하거나 "이미 추가됨" 표시 |
| RQ-2.2.5 | Few-shot 프롬프트 | 고품질 추천 예시를 프롬프트에 포함하여 응답 포맷/품질 일관성 확보 |

### 2.3 한국어 품질 [P1]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-2.3.1 | 톤/말투 가이드 | 존댓말 일관성, 이모지 적절한 사용, 친근하지만 전문적인 톤 |
| RQ-2.3.2 | 장소명 병기 | 한글명 + 영문명(또는 현지어명) 병기 규칙 (예: "신주쿠 교엔 (新宿御苑)") |
| RQ-2.3.3 | 통화/단위 현지화 | 목적지에 따라 적절한 통화, 거리 단위 사용 |

---

## 3. 기능 확장

### 3.1 일정 자동 생성 [P0]

**현재 문제**: 추천 장소를 하나씩 수동으로 일정에 추가해야 함

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-3.1.1 | 자연어 일정 생성 | "3박 4일 도쿄 일정 만들어줘" 입력 시 저장된 장소 기반 일정 자동 구성 |
| RQ-3.1.2 | 동선 최적화 | 거리 기반 그룹핑으로 하루 내 이동 최소화 |
| RQ-3.1.3 | 시간 자동 배분 | 장소 유형별 체류 시간 자동 배분 (식당 1.5h, 관광지 2h, 카페 1h 등) |
| RQ-3.1.4 | 식사 시간 반영 | 아침/점심/저녁 시간대에 식당/카페 자동 배치 |
| RQ-3.1.5 | 일정 프리뷰 | 생성된 일정을 채팅에서 프리뷰하고 "적용" 버튼으로 저장 |
| RQ-3.1.6 | 장소 부족 시 보완 추천 | 저장된 장소만으로 부족할 경우 AI가 추가 장소 제안 |

### 3.2 채팅으로 일정 수정 [P1]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-3.2.1 | 장소 추가 | "둘째 날 오후에 시부야 추가해줘" → 특정 날짜/시간에 장소 추가 |
| RQ-3.2.2 | 장소 제거 | "첫째 날에서 A 장소 빼줘" → 해당 아이템 제거 |
| RQ-3.2.3 | 순서 변경 | "오전 일정 순서 바꿔줘" → 아이템 재배치 |
| RQ-3.2.4 | 날짜 이동 | "B 장소를 셋째 날로 옮겨줘" → 날짜 간 아이템 이동 |
| RQ-3.2.5 | 변경 확인 | 수정 전 변경 사항 프리뷰 표시 + "확인/취소" 버튼 |

### 3.3 비교/필터 추천 [P1]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-3.3.1 | 장소 비교 | "이 근처 라멘집 비교해줘" → 테이블 형태로 2~4개 장소 비교 카드 |
| RQ-3.3.2 | 조건부 추천 | "가성비 좋은 곳", "비 오는 날 실내" 등 조건 필터 적용 |
| RQ-3.3.3 | 카테고리 필터 | "카페만 추천해줘", "맛집 위주로" 등 카테고리 지정 |

### 3.4 멀티모달 입력 [P2]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-3.4.1 | 이미지 입력 | 채팅창에서 이미지 업로드 → 기존 파이프라인으로 장소 추출 |
| RQ-3.4.2 | URL 입력 | 채팅에 URL 공유 → 기존 크롤링 파이프라인으로 분석 |
| RQ-3.4.3 | 분석 결과 대화 연동 | 추출된 장소를 대화 흐름 내에서 표시하고 추가 질문 가능 |

### 3.5 Function Calling 아키텍처 [P0 - 기반 기술]

**현재 문제**: 텍스트 파싱으로 장소 JSON 추출 (4단계 fallback, 불안정)

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-3.5.1 | Function Calling 전환 | Gemini Function Calling으로 장소 추천, 일정 조작 등 구조화된 도구 호출 |
| RQ-3.5.2 | 도구 정의 | `recommend_places`, `add_to_itinerary`, `modify_itinerary`, `compare_places` 등 |
| RQ-3.5.3 | 안전한 실행 | 도구 호출 전 파라미터 검증, 실패 시 사용자 친화적 에러 메시지 |
| RQ-3.5.4 | 확인 프로토콜 | 데이터 변경 도구(추가/수정/삭제)는 실행 전 사용자 확인 |

---

## 4. UX/UI 개선

### 4.1 대화 흐름 개선 [P1]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-4.1.1 | 후속 질문 지원 | 추천 장소 카드에 "자세히 보기" 버튼 → 해당 장소에 대한 상세 질문 자동 전송 |
| RQ-4.1.2 | 지도 연동 | 장소 카드 위에 "지도에서 보기" 버튼 → 지도 뷰에서 해당 장소 하이라이트 |
| RQ-4.1.3 | 추가 추천 | "더 보기" / "다른 추천" 버튼으로 추가 결과 요청 |
| RQ-4.1.4 | 빠른 액션 | 대화 입력 위에 빠른 액션 칩 (일정 생성, 장소 추천, 날씨, 교통) |
| RQ-4.1.5 | 타이핑 인디케이터 | 스트리밍 시작 전 "AI가 생각 중..." 애니메이션 표시 |

### 4.2 채팅 윈도우 개선 [P2]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-4.2.1 | 리사이즈 | 데스크탑에서 채팅 윈도우 크기 조절 가능 (드래그 핸들) |
| RQ-4.2.2 | 전체화면 모드 | 데스크탑에서도 전체화면 전환 토글 |
| RQ-4.2.3 | 대화 검색 | 채팅 내역에서 키워드 검색 |
| RQ-4.2.4 | 핀/북마크 | 중요한 추천 메시지를 핀으로 고정 |

### 4.3 입력 경험 향상 [P2]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-4.3.1 | 음성 입력 | Web Speech API 기반 음성 인식 → 텍스트 변환 입력 |
| RQ-4.3.2 | 이미지 드래그앤드롭 | 채팅창에 이미지 드래그앤드롭으로 업로드 |
| RQ-4.3.3 | 자동완성 | 이전 질문/자주 묻는 질문 기반 입력 자동완성 |

---

## 5. 성능/안정성 개선

### 5.1 응답 속도 [P1]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-5.1.1 | FAQ 캐싱 | 동일 목적지 + 동일 질문 유형의 응답을 캐싱 (TTL: 24시간) |
| RQ-5.1.2 | TTFT 모니터링 | 첫 토큰 응답 시간(TTFT) 측정 및 로그, 목표: 1초 이내 |
| RQ-5.1.3 | 모델 라우팅 | 간단한 Q&A는 경량 모델, 복잡한 추천/일정은 고성능 모델로 자동 분기 |

### 5.2 에러 복원력 [P1]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-5.2.1 | 오프라인 큐잉 | 네트워크 오프라인 시 메시지 로컬 저장, 복구 시 자동 전송 |
| RQ-5.2.2 | 부분 응답 보존 | 스트리밍 중단 시 수신된 부분까지 표시 + "이어서 답변" 옵션 |
| RQ-5.2.3 | Circuit Breaker 알림 | 서비스 장애 시 "잠시 후 다시 시도해주세요" 사용자 알림 + 예상 복구 시간 |

### 5.3 비용 최적화 [P1]

**요구사항**:

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-5.3.1 | 토큰 절감 | 대화 요약 + 캐싱으로 월간 API 비용 30% 이상 절감 |
| RQ-5.3.2 | 사용량 대시보드 | 관리자용 일/주/월 토큰 사용량, 비용, DAU 대시보드 |
| RQ-5.3.3 | 비용 알림 | 일일 비용이 임계치($30, $50) 초과 시 알림 |

---

## 6. 추가 기능

### 6.1 다국어 지원 [P3]

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-6.1.1 | UI 다국어 | 영어, 일본어, 중국어 UI 지원 |
| RQ-6.1.2 | AI 프롬프트 다국어 | 사용자 언어에 맞는 시스템 프롬프트 자동 전환 |
| RQ-6.1.3 | 언어 자동 감지 | 사용자 입력 언어 자동 감지 → 해당 언어로 응답 |

### 6.2 그룹 채팅 [P3]

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-6.2.1 | 공유 채팅방 | 프로젝트 멤버 전원이 보는 공용 채팅방 |
| RQ-6.2.2 | AI 멘션 | @AI 멘션으로 그룹 대화 중 AI 호출 |
| RQ-6.2.3 | 개인/그룹 전환 | 개인 채팅 ↔ 그룹 채팅 전환 가능 |

### 6.3 피드백/분석 [P2]

| ID | 요구사항 | 수락 기준 |
|----|----------|-----------|
| RQ-6.3.1 | 추천 피드백 | 장소 카드에 좋아요/싫어요 버튼 → 향후 추천에 반영 |
| RQ-6.3.2 | 대화 품질 메트릭 | 응답 만족도, 장소 추가율, 대화 길이 등 수집 |
| RQ-6.3.3 | 인기 질문 분석 | 자주 묻는 질문 패턴 → 추천 질문 개선에 활용 |

---

## 7. 비기능 요구사항

### 7.1 성능

| ID | 요구사항 | 목표 |
|----|----------|------|
| NFR-1 | 첫 토큰 응답 시간 (TTFT) | ≤ 1초 |
| NFR-2 | 전체 응답 완료 | ≤ 10초 (일반 Q&A), ≤ 30초 (일정 생성) |
| NFR-3 | 동시 접속자 처리 | 100명 동시 스트리밍 |
| NFR-4 | 캐시 히트율 (FAQ) | ≥ 40% |

### 7.2 비용

| ID | 요구사항 | 목표 |
|----|----------|------|
| NFR-5 | 월간 API 비용 (100 DAU) | ≤ $40 (현재 $58에서 30% 절감) |
| NFR-6 | 일일 비용 상한 | $50 (긴급 차단) |

### 7.3 안정성

| ID | 요구사항 | 목표 |
|----|----------|------|
| NFR-7 | API 성공률 | ≥ 99% |
| NFR-8 | 에러 복구 시간 | Circuit Breaker 30초 내 자동 복구 |
| NFR-9 | 부분 응답 보존율 | 스트리밍 중단 시 90% 이상 텍스트 보존 |

### 7.4 보안

| ID | 요구사항 | 목표 |
|----|----------|------|
| NFR-10 | 프롬프트 인젝션 차단율 | ≥ 95% (현재 22패턴 유지/확장) |
| NFR-11 | Function Calling 보안 | 데이터 변경 도구 100% 사용자 확인 |

---

## 8. 구현 우선순위 로드맵

### Phase 2-A: 핵심 품질 + 기반 기술 [P0]
- RQ-3.5 Function Calling 아키텍처 전환
- RQ-2.1 맥락 이해력 강화
- RQ-2.2 추천 정확도 향상
- RQ-3.1 일정 자동 생성

### Phase 2-B: 기능 확장 + UX [P1]
- RQ-3.2 채팅으로 일정 수정
- RQ-3.3 비교/필터 추천
- RQ-2.3 한국어 품질
- RQ-4.1 대화 흐름 개선
- RQ-5.1 응답 속도 (캐싱, 모델 라우팅)
- RQ-5.2 에러 복원력
- RQ-5.3 비용 최적화

### Phase 2-C: 고급 기능 [P2]
- RQ-3.4 멀티모달 입력
- RQ-4.2 채팅 윈도우 개선
- RQ-4.3 입력 경험 향상
- RQ-6.3 피드백/분석

### Phase 3: 확장 [P3]
- RQ-6.1 다국어 지원
- RQ-6.2 그룹 채팅

---

## 9. 열린 질문

| # | 질문 | 영향 범위 |
|---|------|-----------|
| 1 | Gemini 유지 vs Claude로 전환? Function Calling 지원, 응답 품질 비교 필요 | 전체 아키텍처 |
| 2 | Google Places API 비용 증가 허용 범위? (검증당 $0.032) | RQ-2.2 |
| 3 | 일정 자동 생성 시 "확인 후 저장" vs "즉시 저장 후 수정"? | RQ-3.1 |
| 4 | Function Calling 실패 시 텍스트 파싱 fallback 유지? | RQ-3.5 |
| 5 | 오프라인 큐잉의 범위? (메시지만 vs 장소 추가도) | RQ-5.2 |
| 6 | 다국어 우선순위? (영어 > 일본어 > 중국어?) | RQ-6.1 |

---

## 10. 다음 단계

1. **열린 질문 해결** → 팀 논의/사용자 리서치
2. **`/sc:design`** → 선택된 Phase의 아키텍처 설계
3. **`/sc:workflow`** → 구현 워크플로우 생성
4. **`/sc:implement`** → 단계별 구현
