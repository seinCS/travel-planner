name: Claude PR Review

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      # ì¤‘ìš” íŒŒì¼ ë³€ê²½ ì‹œë§Œ ë¦¬ë·°
      - 'app/**/*.ts'
      - 'app/**/*.tsx'
      - 'lib/**/*.ts'
      - 'components/**/*.tsx'
      - 'prisma/schema.prisma'

concurrency:
  group: pr-review-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          model: "claude-sonnet-4-20250514"

          prompt: |
            ì´ PRì˜ ë³€ê²½ì‚¬í•­ì„ ê²€í† í•´ì£¼ì„¸ìš”.

            ## ê²€í†  í•­ëª©
            1. **ì½”ë“œ í’ˆì§ˆ**: ê°€ë…ì„±, ì¼ê´€ì„±, ì¤‘ë³µ ì½”ë“œ
            2. **TypeScript**: íƒ€ì… ì•ˆì „ì„±, any ì‚¬ìš© ìµœì†Œí™”, ì ì ˆí•œ íƒ€ì… ì •ì˜
            3. **ë³´ì•ˆ**: OWASP Top 10, API í‚¤ ë…¸ì¶œ, SQL Injection, XSS
            4. **ì„±ëŠ¥**: ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§, ë©”ëª¨ë¦¬ ëˆ„ìˆ˜, N+1 ì¿¼ë¦¬
            5. **ì—ëŸ¬ í•¸ë“¤ë§**: ì ì ˆí•œ try-catch, ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
            6. **í…ŒìŠ¤íŠ¸**: í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì—£ì§€ ì¼€ì´ìŠ¤

            ## ì‘ë‹µ í˜•ì‹
            ### ğŸ”´ Critical (ë°˜ë“œì‹œ ìˆ˜ì •)
            - [íŒŒì¼:ë¼ì¸] ì„¤ëª…

            ### ğŸŸ¡ Warning (ê¶Œì¥ ìˆ˜ì •)
            - [íŒŒì¼:ë¼ì¸] ì„¤ëª…

            ### ğŸŸ¢ Info (ì°¸ê³  ì‚¬í•­)
            - [íŒŒì¼:ë¼ì¸] ì„¤ëª…

            ### âœ… ì˜ëœ ì 
            - ì¹­ì°¬í•  ë¶€ë¶„

            í•œêµ­ì–´ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”.

          allowed_tools: |
            Read
            Glob
            Grep
